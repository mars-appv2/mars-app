@extends('layouts.app')
@section('content')
@php /* mk-ipstatic-fallback-v2 */
    if (!isset($if)) {
        try {
            $svc = app(\App\Services\RouterOSService, [\mikrotik => $mikrotik]);
            $if  = $svc->interfaces();
        } catch (\Throwable $e) { $if = []; }
    }
@endphp
@php
  // Fallback: kalau $if belum dikirim controller, ambil dari RouterOSService, aman dengan try/catch
  if (!isset($if)) {
    try { $if = (new \\App\\Services\\RouterOSService($mikrotik))->interfaces(); }
    catch (\Throwable $e) { $if = []; }
  }
@endphp
<style>
  .m-card{background:#121827;border:1px solid #2a3350;border-radius:14px}
  .m-btn{background:#1e293b;color:#fff;border:1px solid #334155;border-radius:10px;padding:.55rem 1rem}
  .m-btnp{background:#3b82f6;border-color:#3b82f6}
  .m-inp,.m-sel{background:#0c101c;border:1px solid #2a3350;border-radius:10px;color:#e6eaf2;padding:.55rem .75rem}
  .m-sel{padding-right:2.2rem;appearance:none}
  .m-selwrap{position:relative}
  .m-selwrap:after{content:'â–¾';position:absolute;right:.65rem;top:50%;transform:translateY(-50%);color:#95a3bf}
  .small{font-size:.85rem;color:#95a3bf}
</style>
<div class="container mx-auto px-2 md:px-4">
  <div class="mb-4 flex gap-2 items-center">
    <a href="{{ route('mikrotik.index') }}" class="m-btn">Table List</a>
    <a href="{{ route('mikrotik.dashboard',$mikrotik) }}" class="m-btn">Dashboard</a>
    <a href="{{ route('mikrotik.pppoe',$mikrotik) }}" class="m-btn">PPPoE</a>
    <a href="{{ route('mikrotik.ipstatic',$mikrotik) }}" class="m-btn m-btnp">IP Static</a>
  </div>

  <div class="m-card p-4 space-y-6">
    <div>
      <div class="small mb-2">Tambahkan IP ke Interface (format CIDR, mis: <b>192.168.10.2/24</b>)</div>
      <form method="POST" action="{{ route('mikrotik.ipstatic.add',$mikrotik) }}">
        @csrf
        <div class="grid md:grid-cols-3 gap-3">
          <div>
            <label class="small">Alamat IP / Prefix</label>
            <input name="ip" class="m-inp w-full" placeholder="192.168.10.2/24" required>
          </div>
          <div>
            <label class="small">Interface</label>
            <div class="m-selwrap">
              <select name="iface" class="m-sel w-full" required>
                @foreach(($if ?? []) as $row)
                  @php $name=$row['name']??''; $type=$row['type']??''; @endphp
                  <option value="{{ $name }}">{{ $name }} {{ $type? '(' . $type . ')' : '' }}</option>
                @endforeach
              </select>
            </div>
          </div>
          <div>
            <label class="small">Comment (opsional)</label>
            <input name="comment" class="m-inp w-full" placeholder="Deskripsi">
          </div>
        </div>
        <div class="mt-3"><button class="m-btn m-btnp">SIMPAN</button></div>
      </form>
    </div>

    <div>
      <div class="small mb-2">Hapus IP dari /ip address</div>
      <form method="POST" action="{{ route('mikrotik.ipstatic.remove',$mikrotik) }}">
        @csrf
        <div class="grid md:grid-cols-2 gap-3">
          <div>
            <label class="small">Alamat IP / Prefix</label>
            <input name="ip" class="m-inp w-full" placeholder="192.168.10.2/24" required>
          </div>
          <div class="flex items-end">
            <button class="m-btn">HAPUS</button>
          </div>
        </div>
      </form>
    </div>

    <div class="small">Catatan: gunakan format CIDR (contoh <b>10.10.10.1/24</b>). Interface diisi sesuai dropdown.</div>
  </div>
</div>
@endsection
